<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–≥–∞–∑–∏–Ω —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —Å–∞–π—Ç–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #fff; }
        
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        
        header { text-align: center; padding: 30px 0; }
        header h1 { font-size: 2rem; margin-bottom: 10px; background: linear-gradient(90deg, #f39c12, #e74c3c); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        header p { color: #888; }
        
        .contacts { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .contacts h3 { color: #f39c12; margin-bottom: 15px; }
        .contact-item { display: flex; align-items: center; gap: 10px; margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.03); border-radius: 8px; }
        .contact-item a { color: #3498db; text-decoration: none; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 15px; border: none; border-radius: 10px; background: rgba(255,255,255,0.1); color: #fff; cursor: pointer; font-size: 14px; }
        .tab.active { background: linear-gradient(90deg, #f39c12, #e74c3c); }
        
        .form-section, .cabinet-section { display: none; }
        .form-section.active, .cabinet-section.active { display: block; }
        
        .order-form { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #aaa; }
        .form-group input, .form-group textarea { width: 100%; padding: 15px; border: none; border-radius: 10px; background: rgba(255,255,255,0.1); color: #fff; font-size: 16px; }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-group input:focus, .form-group textarea:focus { outline: 2px solid #f39c12; }
        
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: linear-gradient(90deg, #f39c12, #e74c3c); color: #fff; font-weight: bold; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(243, 156, 18, 0.3); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .cabinet { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 20px; }
        .cabinet-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .order-card { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin-bottom: 15px; }
        .order-card h4 { color: #f39c12; margin-bottom: 10px; }
        .order-info p { margin: 5px 0; color: #aaa; }
        .order-info span { color: #fff; }
        
        .status-badge { padding: 5px 15px; border-radius: 20px; font-size: 12px; }
        .status-new { background: #3498db; }
        .status-work { background: #f39c12; }
        .status-done { background: #27ae60; }
        .status-cancel { background: #e74c3c; }
        .status-reject { background: #c0392b; }
        .status-cancel-client { background: #8e44ad; }
        
        .btn-cancel { background: #e74c3c; color: #fff; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
        .btn-cancel:hover { background: #c0392b; }
        
        .chat-section { margin-top: 15px; }
        .chat-messages { max-height: 250px; overflow-y: auto; margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; }
        .message { padding: 10px; margin: 5px 0; border-radius: 8px; font-size: 14px; animation: fadeIn 0.3s ease; }
        .message.admin { background: rgba(243, 156, 18, 0.2); border-left: 3px solid #f39c12; }
        .message.client { background: rgba(52, 152, 219, 0.2); border-left: 3px solid #3498db; }
        
        .chat-input { display: flex; gap: 10px; }
        .chat-input input { flex: 1; padding: 12px; border: none; border-radius: 8px; background: rgba(255,255,255,0.1); color: #fff; }
        .chat-input button { padding: 12px 20px; border: none; border-radius: 8px; background: #f39c12; color: #fff; cursor: pointer; }
        
        .notification { position: fixed; top: 20px; right: 20px; padding: 20px 30px; border-radius: 10px; color: #fff; z-index: 1000; animation: slideIn 0.3s ease; }
        .notification.success { background: #27ae60; }
        .notification.error { background: #e74c3c; }
        .notification.info { background: #3498db; }
        
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .empty-orders { text-align: center; padding: 40px; color: #666; }
        .email-input { margin-bottom: 20px; }
        .email-input input { width: 100%; padding: 15px; border: none; border-radius: 10px; background: rgba(255,255,255,0.1); color: #fff; font-size: 16px; }
        .email-input input:focus { outline: 2px solid #f39c12; }
        .btn-load { background: #3498db; color: #fff; padding: 15px; border: none; border-radius: 10px; cursor: pointer; margin-top: 10px; }
        .btn-load:hover { background: #2980b9; }
        
        .folder-tabs { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .folder-tab { padding: 8px 15px; border: none; border-radius: 20px; background: rgba(255,255,255,0.1); color: #fff; white-space: nowrap; cursor: pointer; font-size: 12px; }
        .folder-tab.active { background: #f39c12; }
        
        .auto-refresh { background: rgba(39, 174, 96, 0.2); padding: 8px 15px; border-radius: 8px; margin-bottom: 10px; font-size: 12px; color: #27ae60; display: flex; align-items: center; gap: 8px; }
        .online-indicator { width: 8px; height: 8px; background: #27ae60; border-radius: 50%; animation: pulse 2s infinite; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .typing-indicator { display: none; padding: 10px; font-style: italic; color: #888; font-size: 12px; }
        .typing-indicator.show { display: block; }

        /* --- ADMIN STYLES --- */
        .login-screen { display: none; justify-content: center; align-items: center; min-height: 100vh; position: fixed; top: 0; left: 0; width: 100%; z-index: 2000; background: rgba(0,0,0,0.9); }
        .login-screen.active { display: flex; }
        .login-box { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px; width: 100%; max-width: 400px; }
        .login-box h2 { text-align: center; margin-bottom: 30px; color: #f39c12; }
        
        .admin-screen { display: none; padding: 20px; max-width: 1400px; margin: 0 auto; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a2e; z-index: 2000; overflow-y: auto; }
        .admin-screen.active { display: block; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .header h1 { color: #f39c12; font-size: 1.5rem; }
        .btn-logout { background: #e74c3c; color: #fff; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; }
        
        .instruction { background: rgba(243, 156, 18, 0.1); border: 1px solid #f39c12; border-radius: 10px; padding: 15px; margin-bottom: 20px; display: none; }
        .instruction.show { display: block; }
        .instruction h4 { color: #f39c12; margin-bottom: 10px; }
        .instruction p { color: #aaa; font-size: 0.9rem; line-height: 1.6; }
        .instruction-close { float: right; background: none; border: none; color: #f39c12; cursor: pointer; font-size: 18px; }
        
        .folders { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .folder { padding: 15px 20px; background: rgba(255,255,255,0.05); border-radius: 12px; cursor: pointer; transition: 0.3s; text-align: center; min-width: 100px; border: 2px solid transparent; }
        .folder:hover { background: rgba(255,255,255,0.1); }
        .folder.active { border-color: #f39c12; background: rgba(243, 156, 18, 0.1); }
        .folder h3 { font-size: 1.5rem; margin-bottom: 5px; }
        .folder span { color: #888; font-size: 12px; }
        
        .orders-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 15px; }
        
        .order-card { background: rgba(255,255,255,0.05); border-radius: 15px; overflow: hidden; transition: transform 0.2s; }
        .order-card:hover { transform: translateY(-2px); }
        .order-card.new-message { border: 2px solid #27ae60; box-shadow: 0 0 20px rgba(39, 174, 96, 0.3); }
        .order-header { background: linear-gradient(90deg, #f39c12, #e74c3c); padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; }
        .order-header h4 { font-size: 1rem; }
        .order-header .new-badge { background: #27ae60; padding: 2px 8px; border-radius: 10px; font-size: 10px; }
        
        .order-body { padding: 15px; }
        .order-info { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .order-info p { margin: 0; display: flex; flex-direction: column; }
        .order-info label { color: #888; font-size: 11px; margin-bottom: 2px; }
        .order-info span { color: #fff; font-size: 13px; word-break: break-word; }
        .order-info .full-width { grid-column: span 2; }
        
        .order-actions { padding: 12px 15px; background: rgba(0,0,0,0.2); display: flex; gap: 8px; flex-wrap: wrap; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; min-width: 80px; font-size: 13px; }
        .btn-accept { background: #27ae60; color: #fff; }
        .btn-reject { background: #e74c3c; color: #fff; }
        .btn-done { background: #3498db; color: #fff; }
        .btn-return { background: #9b59b6; color: #fff; }
        .btn-chat { background: #f39c12; color: #fff; }
        
        .chat-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; justify-content: center; align-items: center; padding: 20px; }
        .chat-modal.active { display: flex; }
        .chat-box { background: #1a1a2e; border-radius: 20px; width: 100%; max-width: 600px; max-height: 85vh; display: flex; flex-direction: column; }
        .chat-header { padding: 15px 20px; background: linear-gradient(90deg, #f39c12, #e74c3c); display: flex; justify-content: space-between; align-items: center; border-radius: 20px 20px 0 0; }
        .chat-header h3 { color: #fff; font-size: 1.1rem; }
        .chat-close { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 15px; }
        .message small { color: #888; font-size: 0.75rem; display: block; margin-top: 5px; }
        
        .reject-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3001; justify-content: center; align-items: center; padding: 20px; }
        .reject-modal.active { display: flex; }
        .modal-box { background: #1a1a2e; padding: 25px; border-radius: 20px; width: 100%; max-width: 450px; }
        .modal-box h3 { color: #e74c3c; margin-bottom: 20px; }
        .modal-box textarea { width: 100%; padding: 15px; border: none; border-radius: 10px; background: rgba(255,255,255,0.1); color: #fff; min-height: 120px; resize: vertical; margin-bottom: 15px; }
        .btn-submit { background: #e74c3c; color: #fff; padding: 12px; border: none; border-radius: 8px; width: 100%; cursor: pointer; font-weight: bold; }
        .btn-cancel-modal { background: transparent; border: 1px solid #666; color: #888; padding: 12px; border-radius: 8px; width: 100%; cursor: pointer; margin-top: 10px; }
        
        .btn-login { width: 100%; padding: 15px; border: none; border-radius: 10px; background: linear-gradient(90deg, #f39c12, #e74c3c); color: #fff; font-size: 16px; font-weight: bold; cursor: pointer; }
        
        .empty-folder { text-align: center; padding: 50px; color: #666; grid-column: span 2; }
        
        .file-upload { margin-top: 15px; }
        .file-upload input { display: none; }
        .file-upload label { display: block; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px; text-align: center; cursor: pointer; transition: 0.3s; }
        .file-upload label:hover { background: rgba(255,255,255,0.2); }

        .admin-trigger {
            text-align: center;
            margin-top: 50px;
            font-size: 12px;
            color: #333;
        }
        .admin-trigger a { color: #333; text-decoration: none; cursor: pointer; }
        .admin-trigger a:hover { color: #f39c12; }
        
        /* --- CSS –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ --- */
        :root {
            --bg-body: #1a1a2e;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-input: rgba(255, 255, 255, 0.1);
            --text-main: #fff;
            --text-sec: #aaa;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        body.light-theme {
            --bg-body: #f4f6f9;
            --bg-card: #ffffff;
            --bg-input: #f0f2f5;
            --text-main: #2c3e50;
            --text-sec: #7f8c8d;
            --border-color: #dcdde1;
        }

        /* –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
        body { background: var(--bg-body); color: var(--text-main); transition: background 0.3s, color 0.3s; }
        .contacts, .order-form, .cabinet, .order-card, .login-box { 
            background: var(--bg-card); 
            border: 1px solid var(--border-color); 
        }
        .form-group input, .form-group textarea, .email-input input, .chat-input input { 
            background: var(--bg-input); color: var(--text-main); border: 1px solid var(--border-color); 
        }
        .order-info p span { color: var(--text-main); }
        .order-info label, header p { color: var(--text-sec); }

        /* –ö–Ω–æ–ø–∫–∞ —Ç–µ–º—ã */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 100;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .theme-toggle:hover { transform: scale(1.1) rotate(15deg); }

        /* –ê–¥–º–∏–Ω-–ø–æ–∏—Å–∫ (–¥–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–π —á–∞—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ index.html) */
        .header-controls { display: flex; gap: 10px; align-items: center; }
        .search-input {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-input);
            color: var(--text-main);
            width: 200px;
        }
    </style>
</head>
<body>
    <!-- CLIENT INTERFACE -->
    <div class="container">
        <header>
            <h1>üéÆ –ó–∞–∫–∞–∑ —Å–∫—Ä–∏–ø—Ç–æ–≤</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø–æ–¥ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏</p>
        </header>
        
        <div class="contacts">
            <h3>üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏</h3>
            <div class="contact-item">‚úàÔ∏è <a href="https://t.me/Zagorodnevyellow" target="_blank">@Zagorodnevyellow</a></div>
            <div class="contact-item">üìß <a href="mailto:artemnacinkin055@gmail.com">artemnacinkin055@gmail.com</a></div>
            <div class="contact-item">üí¨ <a href="https://vk.com/artemkamana" target="_blank">vk.com/artemkamana</a></div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('new-order')">üìù –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
            <button class="tab" onclick="switchTab('my-orders')">üìÇ –ú–æ–∏ –∑–∞—è–≤–∫–∏</button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ -->
        <div id="new-order" class="form-section active">
            <form class="order-form" id="orderForm">
                <div class="form-group">
                    <label>üéÆ –ù–∏–∫ –≤ –∏–≥—Ä–µ</label>
                    <input type="text" id="playerNick" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º" required>
                </div>
                <div class="form-group">
                    <label>üí° –ò–¥–µ—è —Å–∫—Ä–∏–ø—Ç–∞</label>
                    <textarea id="scriptIdea" placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç..." required></textarea>
                </div>
                <div class="form-group">
                    <label>‚ö° –ö–æ–º–∞–Ω–¥—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)</label>
                    <textarea id="scriptCommands" placeholder="–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é..."></textarea>
                </div>
                <div class="form-group">
                    <label>üìß –ü–æ—á—Ç–∞</label>
                    <input type="email" id="clientEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>üì± –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <input type="tel" id="clientPhone" placeholder="+7 (999) 123-45-67" required>
                </div>
                <button type="submit" class="btn btn-primary" id="submitBtn">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            </form>
        </div>
        
        <!-- –ö–∞–±–∏–Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ -->
        <div id="my-orders" class="cabinet-section">
            <div class="email-input">
                <label>üìß –í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞—è–≤–æ–∫:</label>
                <input type="email" id="searchEmail" placeholder="your@email.com" value="">
                <button class="btn btn-load" onclick="loadOrders()">üîç –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏</button>
            </div>
            
            <div class="auto-refresh" id="autoRefreshIndicator" style="display: none;">
                <div class="online-indicator"></div>
                <span>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ</span>
            </div>
            
            <div class="folder-tabs" id="folderTabs" style="display: none;">
                <button class="folder-tab active" onclick="filterOrders('all', this)">–í—Å–µ</button>
                <button class="folder-tab" onclick="filterOrders('new', this)">–ù–æ–≤—ã–µ</button>
                <button class="folder-tab" onclick="filterOrders('work', this)">–í —Ä–∞–±–æ—Ç–µ</button>
                <button class="folder-tab" onclick="filterOrders('done', this)">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</button>
            </div>
            <div id="ordersList"></div>
        </div>

        <div class="admin-trigger">
            <a onclick="document.getElementById('loginScreen').classList.add('active')">üîê –ê–¥–º–∏–Ω-–≤—Ö–æ–¥</a>
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
    <button class="theme-toggle" onclick="toggleTheme()" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåì</button>
    
    <!-- ADMIN INTERFACE -->
    <div class="admin-screen" id="adminScreen">
        <div class="header">
            <h1>üìü –ü–ª–∞–Ω—à–µ—Ç-–∞–¥–º–∏–Ω–∫–∞</h1>
            <div class="header-controls">
                <input type="text" class="search-input" id="adminSearchInput" placeholder="–ü–æ–∏—Å–∫ –∑–∞—è–≤–æ–∫...">
                <button class="btn-icon" style="width:36px; height:36px; font-size:16px;" onclick="exportData()" title="–°–∫–∞—á–∞—Ç—å –±—ç–∫–∞–ø">üíæ</button>
                <button class="btn-logout" onclick="logout()">üö™</button>
            </div>
        </div>
        
        <div class="instruction" id="instruction">
            <button class="instruction-close" onclick="hideInstruction()">‚úï</button>
            <h4>üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h4>
            <p>‚Ä¢ <strong>–ù–æ–≤—ã–µ</strong> ‚Äî –ø–æ—Å—Ç—É–ø–∏–≤—à–∏–µ –∑–∞—è–≤–∫–∏<br>
            ‚Ä¢ <strong>–í —Ä–∞–±–æ—Ç–µ</strong> ‚Äî –ø—Ä–∏–Ω—è—Ç—ã–µ –∑–∞—è–≤–∫–∏<br>
            ‚Ä¢ <strong>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</strong> ‚Äî –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏<br>
            ‚Ä¢ <strong>–û—Ç–∫–∞–∑</strong> ‚Äî –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ –≤–∞–º–∏<br>
            ‚Ä¢ <strong>–û—Ç–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞</strong> ‚Äî –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</p>
        </div>
        
        <div class="auto-refresh">
            <div class="online-indicator"></div>
            <span>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫)</span>
        </div>
        
        <div class="folders">
            <div class="folder active" onclick="filterOrdersAdmin('all', this)">
                <h3 id="count-all">0</h3>
                <span>–í—Å–µ</span>
            </div>
            <div class="folder" onclick="filterOrdersAdmin('new', this)">
                <h3 id="count-new">0</h3>
                <span>–ù–æ–≤—ã–µ</span>
            </div>
            <div class="folder" onclick="filterOrdersAdmin('work', this)">
                <h3 id="count-work">0</h3>
                <span>–í —Ä–∞–±–æ—Ç–µ</span>
            </div>
            <div class="folder" onclick="filterOrdersAdmin('done', this)">
                <h3 id="count-done">0</h3>
                <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
            </div>
            <div class="folder" onclick="filterOrdersAdmin('reject', this)">
                <h3 id="count-reject">0</h3>
                <span>–û—Ç–∫–∞–∑</span>
            </div>
            <div class="folder" onclick="filterOrdersAdmin('cancel_client', this)">
                <h3 id="count-cancel">0</h3>
                <span>–û—Ç–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞</span>
            </div>
        </div>
        
        <div class="orders-grid" id="ordersGrid"></div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è -->
    <div class="reject-modal" id="rejectModal">
        <div class="modal-box">
            <h3>‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É</h3>
            <textarea id="rejectReason" placeholder="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è..."></textarea>
            <button class="btn-submit" onclick="confirmReject()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∫–∞–∑</button>
            <button class="btn-cancel-modal" onclick="closeRejectModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª–∫–∞ —á–∞—Ç–∞ -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-box">
            <div class="chat-header">
                <h3 id="chatTitle">–ß–∞—Ç</h3>
                <button class="chat-close" onclick="closeChatModal()">‚úï</button>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="typing-indicator" id="typingIndicator">–ö–ª–∏–µ–Ω—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...</div>
           <div class="chat-input">
            <input type="text" id="chatInput" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
            <button onclick="sendAdminMessage()">üì§</button>
            <label for="adminFileInput" style="background:#27ae60;color:#fff;padding:12px 10px;border-radius:8px;cursor:pointer;">üìé</label>
            <input type="file" id="adminFileInput" style="display:none" onchange="sendAdminFile(this)">
        </div>
        </div>
    </div>
    
    <script>
        /* ================= CLIENT LOGIC ================= */
        let currentFilter = 'all';
        let savedEmail = localStorage.getItem('clientEmail') || '';
        let chatUpdateInterval = null;
        let lastChatUpdate = 0;
        
        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        document.addEventListener('DOMContentLoaded', function() {
            if (savedEmail) {
                document.getElementById('searchEmail').value = savedEmail;
                document.getElementById('clientEmail').value = savedEmail;
            }
        });
        
        function generateId() {
            return 'order_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function showNotification(message, type = 'info') {
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 4000);
        }
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-section, .cabinet-section').forEach(s => s.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            localStorage.setItem('activeTab', tabId);
            
            if (tabId === 'my-orders') {
                loadOrders();
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        }
        
        function getStatusText(status) {
            const texts = {
                'new': 'üìù –ù–æ–≤–∞—è',
                'work': 'üîß –í —Ä–∞–±–æ—Ç–µ',
                'done': '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ',
                'cancel': '‚ùå –û—Ç–º–µ–Ω–µ–Ω–∞',
                'cancel_client': 'üë§ –û—Ç–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞',
                'reject': '‚õî –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'
            };
            return texts[status] || status;
        }
        
        function filterOrders(filter, element) {
            currentFilter = filter;
            document.querySelectorAll('.folder-tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            loadOrders();
        }
        
        function startAutoRefresh() {
            const indicator = document.getElementById('autoRefreshIndicator');
            indicator.style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
            chatUpdateInterval = setInterval(() => {
                const email = document.getElementById('searchEmail').value.trim();
                if (email) {
                    checkForUpdates(email);
                }
            }, 3000);
        }
        
        function stopAutoRefresh() {
            const indicator = document.getElementById('autoRefreshIndicator');
            indicator.style.display = 'none';
            
            if (chatUpdateInterval) {
                clearInterval(chatUpdateInterval);
                chatUpdateInterval = null;
            }
        }
        
        function checkForUpdates(email) {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const myOrders = orders.filter(o => o.email === email);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–∞—Ö
            myOrders.forEach(order => {
                if (order.status === 'work' && order.chat) {
                    const chatKey = `lastUpdate_${order.id}`;
                    const lastUpdate = parseInt(localStorage.getItem(chatKey) || '0');
                    
                    // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    const latestMessage = order.chat[order.chat.length - 1];
                    if (latestMessage && latestMessage.time > lastUpdate) {
                        // –ï—Å—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç
                        if (latestMessage.from === 'admin') {
                            showNotification(`üí¨ –ù–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –∞–¥–º–∏–Ω–∞ –ø–æ –∑–∞—è–≤–∫–µ #${order.id.slice(-6)}`, 'info');
                            // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                            updateChatDisplay(order.id, order.chat);
                        }
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                        localStorage.setItem(chatKey, latestMessage.time.toString());
                    }
                }
            });
        }
        
        function updateChatDisplay(orderId, chatMessages) {
            const chatContainer = document.getElementById(`chat_${orderId}`);
            if (!chatContainer) return;
            
            const isScrolledToBottom = chatContainer.scrollTop + chatContainer.clientHeight >= chatContainer.scrollHeight - 10;
            
            chatContainer.innerHTML = chatMessages.map(m => `
                <div class="message ${m.from}">
                    <strong>${m.from === 'admin' ? 'üë®‚Äçüíª –ê–¥–º–∏–Ω' : 'üë§ –í—ã'}:</strong><br>
                    ${m.fileName ? `
                        üìé ${m.fileName}
                        <br>
                        <a href="${m.fileData}" download="${m.fileName}" style="color:#3498db">–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</a>
                    ` : m.text}
                    <br>
                    <small style="color:#888">${new Date(m.time).toLocaleString('ru-RU')}</small>
                </div>
            `).join('');
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤–Ω–∏–∑—É —á–∞—Ç–∞, –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            if (isScrolledToBottom) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }
        
        function loadOrders() {
            const email = document.getElementById('searchEmail').value.trim();
            
            if (!email) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞—è–≤–æ–∫!', 'error');
                document.getElementById('ordersList').innerHTML = '<div class="empty-orders">üìß –í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏"</div>';
                return;
            }
            
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const myOrders = orders.filter(o => o.email === email);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞—è–≤–∫–∏
            if (myOrders.length > 0) {
                document.getElementById('folderTabs').style.display = 'flex';
            } else {
                document.getElementById('folderTabs').style.display = 'none';
            }
            
            let filtered = currentFilter === 'all' ? myOrders : myOrders.filter(o => o.status === currentFilter);
            
            const container = document.getElementById('ordersList');
            
            if (myOrders.length === 0) {
                container.innerHTML = '<div class="empty-orders">üì≠ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫<br>–ü–æ–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –≤–æ –≤–∫–ª–∞–¥–∫–µ "–ù–æ–≤—ã–π –∑–∞–∫–∞–∑"</div>';
                return;
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-orders">üì≠ –í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç –∑–∞—è–≤–æ–∫</div>';
                return;
            }
            
            container.innerHTML = filtered.map(order => `
                <div class="order-card">
                    <div class="cabinet-header">
                        <h4>üì¶ –ó–∞—è–≤–∫–∞ #${order.id.slice(-6)}</h4>
                        <span class="status-badge status-${order.status}">${getStatusText(order.status)}</span>
                    </div>
                    <div class="order-info">
                        <p>üí° –ò–¥–µ—è: <span>${order.idea}</span></p>
                        <p>‚ö° –ö–æ–º–∞–Ω–¥—ã: <span>${order.commands || '–ù–µ—Ç'}</span></p>
                        <p>üìÖ –î–∞—Ç–∞: <span>${new Date(order.date).toLocaleString('ru-RU')}</span></p>
                        ${order.rejectReason ? `<p style="color:#e74c3c">‚ùå –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞: <span>${order.rejectReason}</span></p>` : ''}
                    </div>
                    
                    ${order.status === 'work' ? `
<div class="chat-section">
    <div class="chat-messages" id="chat_${order.id}">
        ${(order.chat || []).map(m => `
            <div class="message ${m.from}">
                <strong>${m.from === 'admin' ? 'üë®‚Äçüíª –ê–¥–º–∏–Ω' : 'üë§ –í—ã'}:</strong><br>
                ${m.fileName ? `
                    üìé ${m.fileName}
                    <br>
                    <a href="${m.fileData}" download="${m.fileName}" style="color:#3498db">–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</a>
                ` : m.text}
                <br>
                <small style="color:#888">${new Date(m.time).toLocaleString('ru-RU')}</small>
            </div>
        `).join('')}
    </div>
    <div class="chat-input">
        <input type="text" id="msg_${order.id}" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
        <button onclick="sendMessage('${order.id}')">üì§</button>
        <label for="file_${order.id}" style="background:#3498db;color:#fff;padding:12px 10px;border-radius:8px;cursor:pointer;">üìé</label>
        <input type="file" id="file_${order.id}" style="display:none" onchange="sendFile('${order.id}', this)">
    </div>
    <div class="typing-indicator" id="typing_${order.id}">–ê–¥–º–∏–Ω –ø–µ—á–∞—Ç–∞–µ—Ç...</div>
</div>
                    ` : ''}
                    
                    ${order.status === 'new' ? `
                        <button class="btn-cancel" onclick="cancelOrder('${order.id}')">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                    ` : ''}
                </div>
            `).join('');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
            if (document.getElementById('my-orders').classList.contains('active')) {
                startAutoRefresh();
            }
        }
        
        async function sendMessage(orderId) {
            const input = document.getElementById(`msg_${orderId}`);
            const text = input.value.trim();
            if (!text) return;
            
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            
            if (order) {
                order.chat = order.chat || [];
                order.chat.push({ from: 'client', text, time: Date.now() });
                localStorage.setItem('orders', JSON.stringify(orders));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                updateChatDisplay(orderId, order.chat);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É –Ω–∞ –ø–æ—á—Ç—É
                await notifyClientMessage(order, text);
                
                input.value = '';
            }
        }
        
        async function cancelOrder(orderId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É?')) return;
            
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            
            if (order) {
                order.status = 'cancel_client';
                localStorage.setItem('orders', JSON.stringify(orders));
                
                showNotification('–ó–∞—è–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞!', 'info');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∏—Å—å–º–∞
                await notifyOrderCancelledByClient(order);
                
                loadOrders();
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –∫–ª–∏–µ–Ω—Ç–æ–º (–≤ —á–∞—Ç + –Ω–∞ –ø–æ—á—Ç—É –∞–¥–º–∏–Ω–∞)
        async function sendFile(orderId, input) {
            const file = input.files[0];
            if (!file) return;

            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            if (order) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const fileData = e.target.result;
                    order.chat = order.chat || [];
                    order.chat.push({
                        from: 'client',
                        text: '',
                        fileName: file.name,
                        fileData: fileData,
                        time: Date.now()
                    });
                    localStorage.setItem('orders', JSON.stringify(orders));

                    updateChatDisplay(orderId, order.chat);
                    await notifyClientMessage(order, `üìé –ü—Ä–∏–ª–æ–∂–µ–Ω —Ñ–∞–π–ª: ${file.name}`);
                    await sendEmailWithAttachment(
                        'artemnacinkin055@gmail.com',
                        `üìé –§–∞–π–ª –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (${order.nick})`,
                        `–ó–∞—è–≤–∫–∞ #${order.id.slice(-6)}: ${file.name}`,
                        input
                    );
                };
                reader.readAsDataURL(file);
            }
            input.value = '';
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        const savedTab = localStorage.getItem('activeTab');
        if (savedTab && savedTab !== 'new-order') {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-section, .cabinet-section').forEach(s => s.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${savedTab}')"]`).classList.add('active');
            document.getElementById(savedTab).classList.add('active');
            
            if (savedTab === 'my-orders' && savedEmail) {
                loadOrders();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';

            const order = {
                id: generateId(),
                nick: document.getElementById('playerNick').value,
                idea: document.getElementById('scriptIdea').value,
                commands: document.getElementById('scriptCommands').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value,
                date: Date.now(),
                status: 'new',
                chat: [],
                rejectReason: ''
            };

            try {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                orders.push(order);
                localStorage.setItem('orders', JSON.stringify(orders));

                // await notifyNewOrder(order);

                showNotification('‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!', 'success');
                e.target.reset();
                localStorage.setItem('clientEmail', order.email);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        });

        // EmailJS Helpers (stubs for functionality)
        async function notifyClientMessage(order, text) { console.log('Notify admin:', text); }
        async function notifyOrderCancelledByClient(order) { console.log('Notify cancelled'); }
        async function sendEmailWithAttachment(to, subject, body, input) { console.log('Send email attachment'); }
    </script>
    
    <script>
        /* ================= ADMIN LOGIC ================= */
        {
            const ADMIN_CREDENTIALS = { login: 'admin', password: 'admin123' };
            let currentOrderId = null;
            let currentFilter = 'all';
            let ordersUpdateInterval = null;
            let lastOrdersUpdate = 0;
            let chatUpdateInterval = null;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (localStorage.getItem('adminAuth') === 'true') {
                showAdminPanel();
            }
            
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const login = document.getElementById('adminLoginInput').value;
                const password = document.getElementById('adminPasswordInput').value;
                
                if (login === ADMIN_CREDENTIALS.login && password === ADMIN_CREDENTIALS.password) {
                    localStorage.setItem('adminAuth', 'true');
                    localStorage.setItem('adminLoginTime', Date.now().toString());
                    showAdminPanel();
                    showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 'success');
                    document.getElementById('loginScreen').classList.remove('active');
                } else {
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                }
            });
            
            function showAdminPanel() {
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('adminScreen').classList.add('active');
                loadOrdersAdmin();
                startAutoRefreshAdmin();
                
                if (!localStorage.getItem('instructionShown')) {
                    document.getElementById('instruction').classList.add('show');
                    localStorage.setItem('instructionShown', 'true');
                }
            }
            
            function logout() {
                localStorage.removeItem('adminAuth');
                localStorage.removeItem('adminLoginTime');
                stopAutoRefreshAdmin();
                document.getElementById('adminScreen').classList.remove('active');
                document.getElementById('loginScreen').classList.add('active');
            }
            
            function hideInstruction() {
                document.getElementById('instruction').classList.remove('show');
            }
            
            function startAutoRefreshAdmin() {
                ordersUpdateInterval = setInterval(() => {
                    checkForNewOrdersAdmin();
                }, 3000);
            }
            
            function stopAutoRefreshAdmin() {
                if (ordersUpdateInterval) {
                    clearInterval(ordersUpdateInterval);
                    ordersUpdateInterval = null;
                }
                if (chatUpdateInterval) {
                    clearInterval(chatUpdateInterval);
                    chatUpdateInterval = null;
                }
            }
            
            function checkForNewOrdersAdmin() {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const lastUpdate = parseInt(localStorage.getItem('adminLastOrderUpdate') || '0');
                
                const newOrders = orders.filter(o => o.date > lastUpdate);
                if (newOrders.length > 0) {
                    showNotification(`üì¶ ${newOrders.length} –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫!`, 'info');
                    loadOrdersAdmin();
                    localStorage.setItem('adminLastOrderUpdate', Date.now().toString());
                }
                
                orders.forEach(order => {
                    if (order.status === 'work' && order.chat) {
                        const chatKey = `adminLastChat_${order.id}`;
                        const lastChatUpdate = parseInt(localStorage.getItem(chatKey) || '0');
                        
                        const latestMessage = order.chat[order.chat.length - 1];
                        if (latestMessage && latestMessage.time > lastChatUpdate) {
                            if (latestMessage.from === 'client') {
                                showNotification(`üí¨ –ù–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç ${order.nick}`, 'info');
                                highlightOrderCard(order.id);
                            }
                            
                            if (currentOrderId === order.id) {
                                renderChatMessages(order);
                            }
                            
                            localStorage.setItem(chatKey, latestMessage.time.toString());
                        }
                    }
                });
            }
            
            function highlightOrderCard(orderId) {
                const cards = document.querySelectorAll('.order-card');
                cards.forEach(card => {
                    const title = card.querySelector('h4');
                    if (title && title.textContent.includes(orderId.slice(-6))) {
                        card.classList.add('new-message');
                        setTimeout(() => card.classList.remove('new-message'), 3000);
                    }
                });
            }
            
            function loadOrdersAdmin(searchQuery = '') {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                
                let filtered = orders;
                if (searchQuery) {
                    filtered = orders.filter(o => 
                        o.nick.toLowerCase().includes(searchQuery) ||
                        o.email.toLowerCase().includes(searchQuery) ||
                        o.id.includes(searchQuery)
                    );
                }
                
                if (currentFilter !== 'all') {
                    filtered = filtered.filter(o => o.status === currentFilter);
                }

                updateCountsAdmin(orders);
                renderOrdersAdmin(filtered);
                localStorage.setItem('adminLastOrderUpdate', Date.now().toString());
            }
            
            function updateCountsAdmin(orders) {
                document.getElementById('count-all').textContent = orders.length;
                document.getElementById('count-new').textContent = orders.filter(o => o.status === 'new').length;
                document.getElementById('count-work').textContent = orders.filter(o => o.status === 'work').length;
                document.getElementById('count-done').textContent = orders.filter(o => o.status === 'done').length;
                document.getElementById('count-reject').textContent = orders.filter(o => o.status === 'reject').length;
                document.getElementById('count-cancel').textContent = orders.filter(o => o.status === 'cancel_client').length;
            }
            
            function filterOrdersAdmin(filter, element) {
                currentFilter = filter;
                document.querySelectorAll('.folder').forEach(f => f.classList.remove('active'));
                element.classList.add('active');
                loadOrdersAdmin();
            }
            
            function renderOrdersAdmin(orders) {
                const grid = document.getElementById('ordersGrid');
                let filtered = currentFilter === 'all' ? orders : orders.filter(o => o.status === currentFilter);
                
                if (filtered.length === 0) {
                    grid.innerHTML = '<div class="empty-folder">üì≠ –í —ç—Ç–æ–π –ø–∞–ø–∫–µ –Ω–µ—Ç –∑–∞—è–≤–æ–∫</div>';
                    return;
                }
                
                grid.innerHTML = filtered.map(order => `
                    <div class="order-card" id="card_${order.id}">
                        <div class="order-header">
                            <h4>üì¶ #${order.id.slice(-6)}</h4>
                            <span>${getStatusText(order.status)}</span>
                        </div>
                        <div class="order-body">
                            <div class="order-info">
                                <p><label>üéÆ –ù–∏–∫</label><span>${order.nick}</span></p>
                                <p><label>üì± –¢–µ–ª–µ—Ñ–æ–Ω</label><span>${order.phone}</span></p>
                                <p class="full-width"><label>üìß –ü–æ—á—Ç–∞</label><span>${order.email}</span></p>
                                <p class="full-width"><label>üí° –ò–¥–µ—è</label><span>${order.idea}</span></p>
                                <p class="full-width"><label>‚ö° –ö–æ–º–∞–Ω–¥—ã</label><span>${order.commands || '–ù–µ—Ç'}</span></p>
                                ${order.rejectReason ? `<p class="full-width" style="color:#e74c3c"><label>‚ùå –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞</label><span>${order.rejectReason}</span></p>` : ''}
                            </div>
                        </div>
                        <div class="order-actions">
                            ${order.status === 'new' ? `
                                <button class="btn btn-accept" onclick="acceptOrder('${order.id}')">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>
                                <button class="btn btn-reject" onclick="openRejectModal('${order.id}')">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                            ` : ''}
                            ${order.status === 'work' ? `
                                <button class="btn btn-chat" onclick="openChat('${order.id}')">üí¨ –ß–∞—Ç</button>
                                <button class="btn btn-done" onclick="completeOrder('${order.id}')">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                                <button class="btn btn-return" onclick="returnOrder('${order.id}')">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å</button>
                            ` : ''}
                            ${order.status === 'reject' ? `
                                <button class="btn btn-return" onclick="returnOrder('${order.id}')">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É</button>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            async function acceptOrder(orderId) {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const order = orders.find(o => o.id === orderId);
                
                if (order) {
                    order.status = 'work';
                    order.chat = order.chat || [];
                    order.chat.push({
                        from: 'admin',
                        text: 'üëã –ü—Ä–∏–≤–µ—Ç! –Ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –ø—Ä–∏—Å—Ç—É–ø–∏–ª –∫ —Ä–∞–±–æ—Ç–µ –Ω–∞–¥ –≤–∞—à–µ–π –∑–∞—è–≤–∫–æ–π. –°–∫–æ—Ä–æ —Å–≤—è–∂—É—Å—å —Å –≤–∞–º–∏!',
                        time: Date.now()
                    });
                    localStorage.setItem('orders', JSON.stringify(orders));
                    
                    showNotification('–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!', 'success');
                    await notifyClientAccepted(order, '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä');
                    loadOrdersAdmin();
                }
            }
            
            function openRejectModal(orderId) {
                currentOrderId = orderId;
                document.getElementById('rejectModal').classList.add('active');
                document.getElementById('rejectReason').value = '';
            }
            
            function closeRejectModal() {
                document.getElementById('rejectModal').classList.remove('active');
                currentOrderId = null;
            }
            
            async function confirmReject() {
                const reason = document.getElementById('rejectReason').value.trim();
                if (!reason) {
                    showNotification('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è!', 'error');
                    return;
                }
                
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const order = orders.find(o => o.id === currentOrderId);
                
                if (order) {
                    order.status = 'reject';
                    order.rejectReason = reason;
                    localStorage.setItem('orders', JSON.stringify(orders));
                    
                    showNotification('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!', 'success');
                    await notifyOrderRejected(order, reason);
                    closeRejectModal();
                    loadOrdersAdmin();
                }
            }
            
            async function completeOrder(orderId) {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const order = orders.find(o => o.id === orderId);
                
                if (order) {
                    order.status = 'done';
                    localStorage.setItem('orders', JSON.stringify(orders));
                    
                    showNotification('–ó–∞—è–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!', 'success');
                    await notifyOrderDone(order);
                    loadOrdersAdmin();
                }
            }
            
            function returnOrder(orderId) {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const order = orders.find(o => o.id === orderId);
                
                if (order) {
                    order.status = 'new';
                    localStorage.setItem('orders', JSON.stringify(orders));
                    
                    showNotification('–ó–∞—è–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞!', 'success');
                    loadOrdersAdmin();
                }
            }
            
            function openChat(orderId) {
                currentOrderId = orderId;
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    document.getElementById('chatTitle').textContent = `üí¨ ${order.nick}`;
                    renderChatMessages(order);
                    document.getElementById('chatModal').classList.add('active');
                    startChatAutoRefresh(orderId);
                }
            }
            
            function startChatAutoRefresh(orderId) {
                if (chatUpdateInterval) {
                    clearInterval(chatUpdateInterval);
                }
                
                chatUpdateInterval = setInterval(() => {
                    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                    const order = orders.find(o => o.id === orderId);
                    if (order) {
                        renderChatMessages(order);
                    }
                }, 2000);
            }
            
            function renderChatMessages(order) {
                const container = document.getElementById('chatMessages');
                const messages = order.chat || [];
                
                const isScrolledToBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 10;
                
                container.innerHTML = messages.map(m => `
                    <div class="message ${m.from}">
                        ${m.text}
                        ${m.fileName ? `<br>üìé <a href="${m.fileData}" download="${m.fileName}" style="color:#3498db">${m.fileName}</a>` : ''}
                        <br>
                        <small>${new Date(m.time).toLocaleString('ru-RU')}</small>
                    </div>
                `).join('');
                
                if (isScrolledToBottom) {
                    container.scrollTop = container.scrollHeight;
                }
                
                const chatKey = `adminLastChat_${order.id}`;
                const latestMessage = messages[messages.length - 1];
                if (latestMessage) {
                    localStorage.setItem(chatKey, latestMessage.time.toString());
                }
            }
            
            function closeChatModal() {
                document.getElementById('chatModal').classList.remove('active');
                currentOrderId = null;
                
                if (chatUpdateInterval) {
                    clearInterval(chatUpdateInterval);
                    chatUpdateInterval = null;
                }
            }
            
            async function sendAdminMessage() {
                const input = document.getElementById('chatInput');
                const text = input.value.trim();
                if (!text) return;
                
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const order = orders.find(o => o.id === currentOrderId);
                
                if (order) {
                    order.chat = order.chat || [];
                    order.chat.push({ from: 'admin', text, time: Date.now() });
                    localStorage.setItem('orders', JSON.stringify(orders));

                    renderChatMessages(order);
                    input.value = '';
                    await notifyChatMessage(order, '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', text);
                }
            }

            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendAdminMessage();
            });
            
            async function sendAdminFile(input) {
                const file = input.files[0];
                if (!file) return;
                if (!currentOrderId) {
                    showNotification('–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç —Å –∑–∞—è–≤–∫–æ–π', 'error');
                    input.value = '';
                    return;
                }

                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const order = orders.find(o => o.id === currentOrderId);
                if (!order) {
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = async function(e) {
                    const fileData = e.target.result;
                    order.chat = order.chat || [];
                    order.chat.push({
                        from: 'admin',
                        text: '',
                        fileName: file.name,
                        fileData: fileData,
                        time: Date.now()
                    });
                    localStorage.setItem('orders', JSON.stringify(orders));

                    renderChatMessages(order);

                    await notifyChatMessage(order, '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', `üìé –û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ñ–∞–π–ª: ${file.name}`);

                    await sendEmailWithAttachment(
                        order.email,
                        `üìé –§–∞–π–ª –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞`,
                        `–ü–æ –∑–∞—è–≤–∫–µ #${order.id.slice(-6)}: ${file.name}`,
                        input
                    );

                    showNotification('–§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'success');
                };
                reader.readAsDataURL(file);

                input.value = '';
            }

            // Admin Email Stubs
            async function notifyClientAccepted(order, adminName) { console.log('Client accepted notified'); }
            async function notifyOrderRejected(order, reason) { console.log('Client rejected notified'); }
            async function notifyOrderDone(order) { console.log('Client done notified'); }
            async function notifyChatMessage(order, sender, message) { console.log('Chat message notified'); }
            
            // Export data
            window.exportData = function() {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(orders, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "orders_backup.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                showNotification('–ë—ç–∫–∞–ø —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            };
            
            // Search input listener
            document.getElementById('adminSearchInput').addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                loadOrdersAdmin(query);
            });
        }
    </script>
    
    <!-- MAINTENANCE SCREEN -->
    <div class="maintenance-screen" id="maintenanceScreen">
        <div class="maintenance-content">
            <div class="loader"></div>
            <h1>üöß –°–∞–π—Ç –Ω–∞ —Ç–µ—Ö—Ä–∞–±–æ—Ç–∞—Ö</h1>
            <p>–ú—ã –æ–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É. –î–æ–±–∞–≤–ª—è–µ–º –æ–Ω–ª–∞–π–Ω-—á–∞—Ç –∏ –Ω–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.</p>
            <p>–°–∞–π—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–æ—Ä–æ–∂–µ–Ω. –ü—Ä–∏–Ω–æ—Å–∏–º –∏–∑–≤–∏–Ω–µ–Ω–∏—è!</p>
        </div>
        
        <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
        <div style="margin-top: 50px; opacity: 0.3;">
            <button onclick="document.getElementById('maintenanceScreen').style.display='none'; document.getElementById('loginScreen').classList.add('active'); document.getElementById('loginScreen').style.display='flex';" style="background:none; border:none; color:#444; cursor:pointer;">
                –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            </button>
        </div>
    </div>
</body>
</html>